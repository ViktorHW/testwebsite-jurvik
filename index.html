<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplayer Tic-Tac-Toe</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .status {
            margin: 15px 0;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 5px;
            margin-bottom: 20px;
        }
        
        .cell {
            width: 100px;
            height: 100px;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .cell:hover {
            background-color: #d0d0d0;
        }
        
        .game-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .game-id {
            margin: 10px 0;
            font-size: 16px;
        }
        
        .join-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px 0;
        }
        
        input {
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            width: 200px;
        }
        
        .players-info {
            margin: 10px 0;
            font-size: 16px;
        }
        
        .player-x {
            color: #E91E63;
        }
        
        .player-o {
            color: #2196F3;
        }
        
        .win-combo {
            background-color: #FFEB3B;
        }
    </style>
</head>
<body>
    <h1>Multiplayer Tic-Tac-Toe</h1>
    <div class="game-container">
        <div id="playerInfo" class="players-info">
            Waiting for players...
        </div>
        <div id="gameStatus" class="status">Game not started</div>
        <div class="board" id="board">
            <div class="cell" data-index="0"></div>
            <div class="cell" data-index="1"></div>
            <div class="cell" data-index="2"></div>
            <div class="cell" data-index="3"></div>
            <div class="cell" data-index="4"></div>
            <div class="cell" data-index="5"></div>
            <div class="cell" data-index="6"></div>
            <div class="cell" data-index="7"></div>
            <div class="cell" data-index="8"></div>
        </div>
        <div class="game-controls">
            <button id="createGame">Create New Game</button>
            <div class="game-id" id="gameIdDisplay"></div>
            <div class="join-container">
                <input type="text" id="gameIdInput" placeholder="Enter Game ID to join">
                <button id="joinGame">Join Game</button>
            </div>
            <button id="resetGame" style="display: none;">Reset Game</button>
        </div>
    </div>

    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/8.10.1/firebase-app.min.js"></script>
    <!-- Firebase database -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/8.10.1/firebase-database.min.js"></script>
    
    <script>
        // Initialize Firebase with your config
        // For demo purposes - replace with your Firebase config when deploying
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Game state
        let currentGameId = null;
        let playerId = null;
        let playerSymbol = null;
        let currentTurn = null;
        let gameRef = null;

        // DOM elements
        const board = document.getElementById('board');
        const cells = document.querySelectorAll('.cell');
        const gameStatus = document.getElementById('gameStatus');
        const playerInfo = document.getElementById('playerInfo');
        const createGameBtn = document.getElementById('createGame');
        const joinGameBtn = document.getElementById('joinGame');
        const resetGameBtn = document.getElementById('resetGame');
        const gameIdInput = document.getElementById('gameIdInput');
        const gameIdDisplay = document.getElementById('gameIdDisplay');

        // Event listeners
        createGameBtn.addEventListener('click', createGame);
        joinGameBtn.addEventListener('click', joinGame);
        resetGameBtn.addEventListener('click', resetGame);
        cells.forEach(cell => cell.addEventListener('click', handleCellClick));

        // Generate a random ID
        function generateId() {
            return Math.random().toString(36).substring(2, 8);
        }

        // Create a new game
        function createGame() {
            const gameId = generateId();
            playerId = generateId();
            playerSymbol = 'X';
            currentGameId = gameId;
            
            gameRef = database.ref(`games/${gameId}`);
            
            const initialGameState = {
                board: Array(9).fill(''),
                players: {
                    [playerId]: {
                        symbol: 'X',
                        active: true
                    }
                },
                status: 'waiting',
                currentTurn: playerId
            };
            
            gameRef.set(initialGameState)
                .then(() => {
                    gameIdDisplay.textContent = `Game ID: ${gameId}`;
                    gameStatus.textContent = 'Waiting for opponent to join...';
                    playerInfo.textContent = 'You are Player X';
                    
                    // Listen for game state changes
                    setupGameListeners();
                })
                .catch(error => {
                    console.error('Error creating game:', error);
                    gameStatus.textContent = 'Error creating game';
                });
        }

        // Join an existing game
        function joinGame() {
            const gameId = gameIdInput.value.trim();
            
            if (!gameId) {
                gameStatus.textContent = 'Please enter a valid Game ID';
                return;
            }
            
            playerId = generateId();
            currentGameId = gameId;
            
            gameRef = database.ref(`games/${gameId}`);
            
            gameRef.once('value')
                .then(snapshot => {
                    const gameData = snapshot.val();
                    
                    if (!gameData) {
                        gameStatus.textContent = 'Game not found';
                        return;
                    }
                    
                    if (gameData.status !== 'waiting') {
                        gameStatus.textContent = 'Game already in progress or ended';
                        return;
                    }
                    
                    playerSymbol = 'O';
                    
                    const updates = {};
                    updates[`players/${playerId}`] = {
                        symbol: 'O',
                        active: true
                    };
                    updates['status'] = 'playing';
                    
                    return gameRef.update(updates);
                })
                .then(() => {
                    if (playerSymbol) {
                        gameIdDisplay.textContent = `Game ID: ${gameId}`;
                        gameStatus.textContent = 'Game in progress';
                        playerInfo.textContent = 'You are Player O';
                        
                        // Listen for game state changes
                        setupGameListeners();
                    }
                })
                .catch(error => {
                    console.error('Error joining game:', error);
                    gameStatus.textContent = 'Error joining game';
                });
        }

        // Handle cell click
        function handleCellClick(event) {
            if (!currentGameId || !playerId) {
                gameStatus.textContent = 'Please create or join a game first';
                return;
            }
            
            const cellIndex = event.target.dataset.index;
            
            gameRef.once('value')
                .then(snapshot => {
                    const gameData = snapshot.val();
                    
                    if (gameData.status !== 'playing') {
                        return;
                    }
                    
                    if (gameData.currentTurn !== playerId) {
                        gameStatus.textContent = "It's not your turn";
                        return;
                    }
                    
                    if (gameData.board[cellIndex] !== '') {
                        gameStatus.textContent = 'Cell already taken';
                        return;
                    }
                    
                    // Update the board
                    const updatedBoard = [...gameData.board];
                    updatedBoard[cellIndex] = playerSymbol;
                    
                    // Check for win or draw
                    const result = checkGameResult(updatedBoard);
                    
                    const updates = {};
                    updates['board'] = updatedBoard;
                    
                    // Find the opponent
                    const opponentId = Object.keys(gameData.players).find(id => id !== playerId);
                    
                    if (result.win) {
                        updates['status'] = 'ended';
                        updates['winner'] = playerId;
                        updates['winningCombo'] = result.combo;
                    } else if (result.draw) {
                        updates['status'] = 'ended';
                        updates['winner'] = 'draw';
                    } else {
                        updates['currentTurn'] = opponentId;
                    }
                    
                    return gameRef.update(updates);
                })
                .catch(error => {
                    console.error('Error updating game:', error);
                });
        }

        // Check for win or draw
        function checkGameResult(board) {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
                [0, 4, 8], [2, 4, 6]             // diagonals
            ];
            
            // Check for win
            for (const pattern of winPatterns) {
                const [a, b, c] = pattern;
                if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                    return { win: true, combo: pattern };
                }
            }
            
            // Check for draw
            const isDraw = board.every(cell => cell !== '');
            
            return { win: false, draw: isDraw };
        }

        // Reset the game
        function resetGame() {
            if (!currentGameId || !gameRef) return;
            
            const initialBoard = Array(9).fill('');
            
            gameRef.once('value')
                .then(snapshot => {
                    const gameData = snapshot.val();
                    
                    if (!gameData) return;
                    
                    const firstPlayerId = Object.keys(gameData.players)[0];
                    
                    const updates = {
                        board: initialBoard,
                        status: 'playing',
                        currentTurn: firstPlayerId,
                        winner: null,
                        winningCombo: null
                    };
                    
                    return gameRef.update(updates);
                })
                .catch(error => {
                    console.error('Error resetting game:', error);
                });
        }

        // Setup game listeners
        function setupGameListeners() {
            if (!gameRef) return;
            
            gameRef.on('value', snapshot => {
                const gameData = snapshot.val();
                
                if (!gameData) return;
                
                // Update the board
                updateBoard(gameData.board);
                
                // Update game status
                updateGameStatus(gameData);
                
                // Show/hide reset button
                resetGameBtn.style.display = gameData.status === 'ended' ? 'block' : 'none';
                
                // Highlight winning cells
                if (gameData.winningCombo) {
                    highlightWinningCells(gameData.winningCombo);
                }
            });
        }

        // Update the board on the screen
        function updateBoard(boardData) {
            cells.forEach((cell, index) => {
                cell.textContent = boardData[index];
                cell.classList.remove('win-combo');
            });
        }

        // Update game status text
        function updateGameStatus(gameData) {
            // Update players info
            if (gameData.players) {
                const playerCount = Object.keys(gameData.players).length;
                if (playerCount < 2) {
                    playerInfo.textContent = `You are Player ${playerSymbol} - Waiting for opponent`;
                } else {
                    playerInfo.textContent = `You are Player ${playerSymbol}`;
                }
            }
            
            // Update game status
            if (gameData.status === 'waiting') {
                gameStatus.textContent = 'Waiting for opponent to join...';
            } else if (gameData.status === 'playing') {
                if (gameData.currentTurn === playerId) {
                    gameStatus.textContent = 'Your turn';
                } else {
                    gameStatus.textContent = "Opponent's turn";
                }
            } else if (gameData.status === 'ended') {
                if (gameData.winner === 'draw') {
                    gameStatus.textContent = 'Game ended in a draw';
                } else if (gameData.winner === playerId) {
                    gameStatus.textContent = 'You won!';
                } else {
                    gameStatus.textContent = 'You lost!';
                }
            }
        }

        // Highlight winning cells
        function highlightWinningCells(winningCombo) {
            winningCombo.forEach(index => {
                cells[index].classList.add('win-combo');
            });
        }
    </script>
</body>
</html>
